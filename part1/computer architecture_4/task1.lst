GAS LISTING task6.s 			page 1


   1              	/*
   2              	
   3              	    –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –æ —Å–≤—è–∑—è—Ö
   4              	
   5              	*/
   6              	    .include "my-macro" # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏
   1              	.macro Finish
   2              		movl $1, %eax 		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit
   3              		movl $0, %ebx 		# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
   4              		int $0x80 		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
   5              	.endm
   6              	
   7              	.macro Getchar buf_addr
   8              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
   9              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  10              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  11              		     			# –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  12              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  13              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  14              	.endm
  15              	
  16              	.macro PutStr string
  17              	.data
  18              	    str\@: 	.ascii "\string"
  19              		
  20              	    strlen\@ = 	. - str\@
  21              	
  22              	.text
  23              		movl $4, %eax
  24              		movl $1, %ebx	
  25              		movl $str\@, %ecx
  26              		movl $strlen\@, %edx
  27              		int $0x80
  28              	.endm
  29              	
  30              	.macro PutInt integer
  31              	.data
  32              		ten\@:	.long 10
  33              	.text
  34              		movl \integer, %eax
  35              		xorl %esi, %esi
  36              		cmpl $0, %eax
  37              		jge loop\@
  38              		neg %eax
  39              	loop\@:
  40              		movl $0, %edx
  41              		divl ten\@
  42              		addl $'0', %edx
  43              		pushl %edx
  44              	
  45              		incl %esi
  46              		cmpl $0, %eax
  47              		jz next\@
  48              		jmp loop\@
  49              	next\@:
  50              		cmpl $0, %esi
  51              		jz quit\@
GAS LISTING task6.s 			page 2


  52              		decl %esi
  53              		movl $4, %eax
  54              		movl %esp, %ecx
  55              		movl $1, %ebx
  56              		movl $1, %edx
  57              		int $0x80
  58              		addl $4, %esp
  59              		jmp next\@
  60              	quit\@:
  61              	.endm
  62              	
  63              	.macro Len string
  64              	.data
  65              	    	str\@: 	.ascii "\string"
  66              	   	strlen\@ = 	. - str\@
  67              	.text
  68              		movl $strlen\@, %eax
  69              	.endm
   7              	
   8              	.data # —Å–µ–∫—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
   9              	
  10 0000 00000000 	b:	.long 0
  11              	
  12              	
  13              	Symbols:
  14 0004 39314132 	        .asciz  "91A23B456C789" # –º–∞—Å—Å–∏–≤ —Å–∏–º–≤–æ–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
  14      33423435 
  14      36433738 
  14      3900
  15              	#                                 —Ü–∏—Ñ—Ä –∏ "–Ω–µ —Ü–∏—Ñ—Ä"
  16              	
  17              	.bss    # —Å–µ–∫—Ü–∏—è –æ–±—â–µ–π –ø–∞–º—è—Ç–∏ (–¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞)
  18              	
  19              	.lcomm  numbers, 40             # –º–∞—Å—Å–∏–≤ 4-—Ö –±–∞–π—Ç–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π —Ü–∏—Ñ—Ä
  20              	
  21              	        .text # —Å–µ–∫—Ü–∏—è –∫–æ–º–∞–Ω–¥ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞
  22              	
  23              	.type   Read_Sym, @function     # —Ñ—É–Ω–∫—Ü–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Å—Å
  24              	
  25              	Read_Sym:
  26              	
  27              	/*
  28              	        –ß–∏—Ç–∞–µ—Ç <–ü–∞—Ä–∞–º–µ—Ç—Ä1> —Å–∏–º–≤–æ–ª–æ–≤ –∏–∑ –º–∞—Å—Å–∏–≤–∞ <–ü–∞—Ä–∞–º–µ—Ç—Ä2>
  29              	        –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç –∏—Ö –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —Ñ—É–Ω–∫—Ü–∏–∏ Trans_Sym.
  30              	        –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ –º–∞—Å—Å–∏–≤ Numbers
  31              	*/
  32              	#       –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–ª–æ–≥ —Ñ—É–Ω—Ü–∏–∏
  33              	
  34 0000 55       	        pushl %ebp       # —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å—Ç–µ–∫–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –±—ã–≤—à–µ–µ –≤ –≤—ã–
  35 0001 89E5     	        movl  %esp, %ebp # –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∞–¥—Ä–µ—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
  36              	                         # –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω–Ω—ã–º –≤ —Å—Ç–µ–∫–µ –ø—É—Ç–µ–º –±–∞–
  37              	                         # –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ebp
  38 0003 83EC04   	        subl  $4, %esp   # –∑–∞–≤–µ—Å—Ç–∏ 4-—Ö –±–∞–π—Ç–æ–≤—É—é –ª–æ–∫–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω
  39 0006 B8DADADA 	        movl  $0xdadadada,%eax
  39      DA
  40 000b 8945FC   	        movl  %eax,-4(%ebp)
  41 000e B8FEFEFE 	        mov   $0xfefefefe,%eax
GAS LISTING task6.s 			page 3


  41      FE
  42 0013 C745FC00 	        movl $0, -4(%ebp)
  42      000000
  43              	#       –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
  44              	
  45 001a 29C9     	        subl %ecx, %ecx   # –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–µ—Ç—á–∏–∫–∞ —Ü–∏–∫–ª–∞ 
  46              	NextSym:
  47 001c 8B550C   	        movl 12(%ebp), %edx  # –∞–¥—Ä–µ—Å –≤—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞-–º–∞—Å—Å–∏–≤–∞ –≤ edx
  48              	
  49              	#       –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ Trans_Sym
  50              	
  51              	
  52              	
  53 001f 29DB     	        subl %ebx, %ebx             # –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ ebx –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å–∏–º–≤–æ–ª–∞
  54 0021 8A1C0A   	        movb (%edx,%ecx,1), %bl     # —Å–∏–º–≤–æ–ª –≤ ebx
  55              	        
  56              	        
  57              	        
  58              	        
  59 0024 83FB39   	        cmpl $'9', %ebx  	# –∫–æ–¥ –±–æ–ª—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '9' ?
  60 0027 7731     		ja letter	
  61 0029 83FB30   		cmpl $'0', %ebx	# –∫–æ–¥ –º–µ–Ω—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '0' ?
  62 002c 722C     		jb letter 
  63              	        
  64              	        
  65              	        
  66              	        
  67              	
  68              	#       –ù–∞—á–∏–Ω–∞–µ–º –≤—ã–∑–æ–≤ Trans_Sym
  69              	
  70 002e 60       	        pusha   # —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä—ã —Ç–µ–∫—É—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏ Read_Sym
  71              	
  72 002f 53       	        pushl %ebx                # –ü–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–∏ Trans_Sym (–∫–æ–¥ 
  73              	                                  # —Å–∏–º–≤–æ–ª–∞ –∏–∑ –º–∞—Å—Å–∏–≤–∞) –≤ —Å—Ç–µ–∫
  74 0030 E8180000 	        call Trans_Sym
  74      00
  75              	
  76 0035 83C404   	        addl    $4,%esp      # –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–µ–∫ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Trans_Sym
  77              	
  78 0038 89048D00 	        movl    %eax, numbers(,%ecx,4) # –∑–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç Trans-Sym
  78      000000
  79              	
  80 003f 61       	        popa   # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä—ã Read_Sym
  81              	        
  82              	go_back:
  83 0040 41       	        incl %ecx            # –Ω–∞—Ä–∞—â–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ —Ü–∏–∫–ª–∞
  84 0041 3B4D08   	        cmpl 8(%ebp), %ecx   # —Å—á–µ—Ç—á–∏–∫ —Ä–∞–≤–µ–Ω –ø–µ—Ä–≤–æ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—É?
  85 0044 75D6     	        jne NextSym          # –î–ê, –ø–æ–≤—Ç–æ—Ä—è–µ–º
  86              	                             # –ù–ï–¢ - –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
  87 0046 8B45FC   		movl -4(%ebp), %eax
  88              	#       –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —ç–ø–∏–ª–æ–≥ —Ñ—É–Ω–∫—Ü–∏–∏
  89              	
  90 0049 89EC     	        movl %ebp, %esp # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞
  91 004b 5D       	        popl %ebp       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ebp
  92 004c C3       	        ret             # –≤–æ–∑–≤—Ä–∞—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â—É—é
  93              	
  94              	# –∫–æ–Ω–µ—Ü Read_Sym
GAS LISTING task6.s 			page 4


  95              	
  96              	/*
  97              	    –§—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ –≤ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—
  98              	    <–ü–∞—Ä–µ–º–µ—Ç—Ä1> –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —á–∏—Å–ª–æ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ eax
  99              	
 100              	.type   Trans_Sym, @function
 101              	
 102              	Trans_Sym:
 103              	
 104              	#       –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–ª–æ–≥ —Ñ—É–Ω—Ü–∏–∏
 105              	
 106 004d 55       	        pushl %ebp       # —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å—Ç–µ–∫–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –±—ã–≤—à–µ–µ –≤ –≤—ã–
 107 004e 89E5     	        movl  %esp, %ebp # –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∞–¥—Ä–µ—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
 108              	                         # –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω–Ω—ã–º –≤ —Å—Ç–µ–∫–µ –ø—É—Ç–µ–º –±–∞–
 109              	                         # –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ebp
 110              	
 111              	#       —Ç–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
 112              	
 113 0050 8B4508   	        movl 8(%ebp), %eax  # –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ eax
 114 0053 83E830   	        subl $0x30, %eax    # –ø–æ–ª—É—á–µ–Ω–∏–µ —á–∏—Å–ª–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
 115              	
 116              	#       –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —ç–ø–∏–ª–æ–≥ —Ñ—É–Ω–∫—Ü–∏–∏
 117              	
 118 0056 89EC     	        movl %ebp, %esp # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞
 119 0058 5D       	        popl %ebp       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ebp
 120 0059 C3       	        ret             # –≤–æ–∑–≤—Ä–∞—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â—É—é
 121              	
 122              	
 123              	
 124              	
 125              	
 126              	letter:
 127 005a FF45FC   		incl -4(%ebp)
 128 005d EBE1     		jmp go_back
 129              	
 130              	
 131              	
 132              	
 133              	.global _start # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞
 134              	
 135              	_start:
 136              	
 137 005f 90       	                nop
 138              	
 139 0060 60       	                pusha   # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –≥–ª–∞–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
 140              	
 141 0061 68040000 	                pushl $Symbols  # –ü–∞—Ä–∞–º–µ—Ç—Ä-2 - –∞–¥—Ä–µ—Å –º–∞—Å—Å–∏–≤–∞ –≤ —Å—Ç–µ–∫
 141      00
 142 0066 6A08     	                pushl $8        # –ü–∞—Ä–∞–º–µ—Ç—Ä-1 –≤ —Å—Ç–µ–∫
 143              	
 144 0068 E893FFFF 	                call Read_Sym   # –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
 144      FF
 145 006d A3000000 	                movl %eax, b
 145      00
 146 0072 83C408   	                addl $8,%esp    # –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–µ–∫ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Read_Sym
 147 0075 61       	                popa         # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä—ã –≥–ª–∞–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–
 148              	
GAS LISTING task6.s 			page 5


 149              	                Finish # –∫–æ–Ω–µ—Ü —Ä–∞–±–æ—Ç—ã, –≤–æ–∑–≤—Ä–∞—Ç –≤ –û–° (–º–∞–∫—Ä–æ –∏–∑ —Ñ–∞–π–ª–
 149 0076 B8010000 	>  movl $1,%eax
 149      00
 149 007b BB000000 	>  movl $0,%ebx
 149      00
 149 0080 CD80     	>  int $0x80
 150              	                .end   # –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
GAS LISTING task6.s 			page 6


DEFINED SYMBOLS
             task6.s:10     .data:0000000000000000 b
             task6.s:13     .data:0000000000000004 Symbols
             task6.s:19     .bss:0000000000000000 numbers
             task6.s:25     .text:0000000000000000 Read_Sym
             task6.s:46     .text:000000000000001c NextSym
             task6.s:126    .text:000000000000005a letter
             task6.s:102    .text:000000000000004d Trans_Sym
             task6.s:82     .text:0000000000000040 go_back
             task6.s:135    .text:000000000000005f _start

NO UNDEFINED SYMBOLS
