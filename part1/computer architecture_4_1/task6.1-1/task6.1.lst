GAS LISTING fact.S 			page 1


   1              	/*
   2              	
   3              	    –ü–æ–¥–ø—Ä–æ–≥—Ä–∞–º–º—ã –∏ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è –æ —Å–≤—è–∑—è—Ö
   4              	
   5              	*/
   6              	.include "my-macro" # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏
   1              	/*
   2              	 * –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
   3              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
   4              	 * 	- –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
   5              	 *
   6              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
   7              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              		movl $1, %eax 		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit
  11              		movl \ret_val, %ebx 	# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
  12              		int $0x80 		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–∏–
  18              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  19              	 * 	- –∞–¥—Ä–µ—Å –±—É—Ñ—Ñ–µ—Ä–∞ –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞
  20              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  21              	 *	- –≤ %eax –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  22              	 *	- –ø–æ –∞–¥—Ä–µ—Å—É buf_addr - —Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  23              	 *
  24              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  25              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 read'
  26              	*/
  27              	.macro Getchar buf_addr
  28              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
  29              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  30              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  31              		     			# –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  32              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  33              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  34              	.endm
  35              	
  36              	/*
  37              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∞–Ω–¥
  38              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  39              	 * 	- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞.
  40              	 *
  41              	 * –ü—Ä–∏–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞:
  42              	 *	Puts "–¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º–æ–π —Å—Ç—Ä–æ–∫–∏"
  43              	 *
  44              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  45              	 *	- –≤—ã–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª—ã –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫
  46              	 *	  –∞ —Ç–∞–∫–∂–µ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏
  47              	 *
  48              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  49              	 * –°–º. —Ç–∞–∫–∂–µ 'man puts', 'man 2 write'
  50              	*/
  51              	.macro Puts string
GAS LISTING fact.S 			page 2


  52              	.data
  53              	    str\@: 	.ascii "\string\n"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª
  54              	
  55              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  56              	
  57              	.text
  58              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  59              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  60              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  61              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  62              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  63              	.endm
  64              	
  65              	.macro PutsRes res
  66              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  67              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  68              		movl \res, %ecx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ–
  69              		addl $10, %ecx
  70              		subl length, %ecx
  71              		movl length, %edx # –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  72              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  73              	.endm
   7              	
   8              	.data # —Å–µ–∫—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
   9 0000 00000000 		result:	.long 0
  10 0004 00000000 	  number: .long 0
  11 0008 20202020 	  digits_of_n:	.ascii "          "
  11      20202020 
  11      2020
  12 0012 00000000 	  length: .long 0         # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ 10 —Ü–∏—Ñ—Ä –≤ —á–∏—Å–ª–µ
  13 0016 0A000000 	  ten: 	.long 10       # –¥–µ–ª–∏—Ç–µ–ª—å
  14              	
  15              	.bss
  16              		.lcomm buf, 100		# –ë—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤. –†–
  17              		.lcomm c, 1		# –ë—É—Ñ–µ—Ä –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞. –†–∞–∑–º–µ—Ä - 1 –±
  18              	
  19              	.text # —Å–µ–∫—Ü–∏—è –∫–æ–º–∞–Ω–¥ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞
  20              	
  21              	.type   Fact, @function     # —Ñ—É–Ω–∫—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª–∞ —á–∏—Å–ª–∞
  22              	
  23              	Fact:
  24              	
  25              	/*
  26              	        –ß–∏—Ç–∞–µ—Ç —á–∏—Å–ª–æ –∏–∑ —Å—Ç–µ–∫–∞ –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –µ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∏–∞–ª
  27              	*/
  28              	#       –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–ª–æ–≥ —Ñ—É–Ω—Ü–∏–∏
  29              	
  30 0000 55       	  pushl %ebp       # —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å—Ç–µ–∫–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –±—ã–≤—à–µ–µ –≤ –≤—ã–∑—ã–≤–
  31 0001 89E5     	  movl  %esp, %ebp # –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∞–¥—Ä–µ—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏
  32              	                         # –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω–Ω—ã–º –≤ —Å—Ç–µ–∫–µ –ø—É—Ç–µ–º –±–∞–
  33              	                         # –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ebp
  34 0003 83EC04   		subl $4, %esp
  35 0006 C745FC01 	  movl $1, -4(%ebp)   # –õ–æ–∫–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è
  35      000000
  36              	
  37              	#       –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
  38              	FactStep:
GAS LISTING fact.S 			page 3


  39 000d 837D0800 	  cmpl $0, 8(%ebp)		# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –Ω—É–ª–µ–º
  40 0011 741B     	  je Return 		# –ï—Å–ª–∏ —Ä–∞–≤–Ω–æ 0 —Ç–æ –∑–∞–≤–µ—Ä—à–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
  41              	
  42 0013 8B4D08   		movl 8(%ebp), %ecx
  43 0016 894DFC   		movl %ecx, -4(%ebp)
  44 0019 FF4D08   		decl 8(%ebp)
  45              	
  46 001c FF7508   		pushl 8(%ebp)
  47 001f E8DCFFFF 		call Fact
  47      FF
  48 0024 83C404   		addl $4, %esp
  49 0027 F765FC   		mull -4(%ebp)
  50              	
  51              	EndReturn:
  52 002a 89EC     		movl %ebp, %esp # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞
  53 002c 5D       		popl %ebp       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ebp
  54 002d C3       		ret             # –≤–æ–∑–≤—Ä–∞—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â—É—é
  55              	
  56              	Return:
  57 002e 89EC     		movl %ebp, %esp # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞
  58 0030 B8010000 	  movl $1, %eax
  58      00
  59 0035 5D       	  popl %ebp       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ebp
  60 0036 C3       	  ret             # –≤–æ–∑–≤—Ä–∞—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â—É—é
  61              	
  62              	
  63              	
  64              	
  65              	.global _start # —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –º–µ—Ç–∫–∞
  66              	
  67              	_start:
  68              	
  69 0037 90       	  nop
  70              	
  71 0038 60       	  pusha   # —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –≥–ª–∞–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã
  72              	
  73              	  Puts "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ < 13"
  73              	> .data
  73 001a D092D0B2 	>  str0:.ascii "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ < 13\n"
  73      D0B5D0B4 
  73      D0B8D182 
  73      D0B520D1 
  73      87D0B8D1 
  73              	> 
  73              	>  strlen0 =. - str0
  73              	> 
  73              	> .text
  73 0039 B8040000 	>  movl $4,%eax
  73      00
  73 003e BB010000 	>  movl $1,%ebx
  73      00
  73 0043 B91A0000 	>  movl $str0,%ecx
  73      00
  73 0048 BA1F0000 	>  movl $strlen0,%edx
  73      00
  73 004d CD80     	>  int $0x80
  74              	
GAS LISTING fact.S 			page 4


  75              	kbd_input:
  76              	  Getchar $c          # –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–
  76 004f B8030000 	>  movl $3,%eax
  76      00
  76 0054 BB000000 	>  movl $0,%ebx
  76      00
  76 0059 B9640000 	>  movl $c,%ecx
  76      00
  76              	>  
  76 005e BA010000 	>  movl $1,%edx
  76      00
  76 0063 CD80     	>  int $0x80
  77              	
  78 0065 83F800   	  cmpl $0, %eax 	# –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª - EOF (–≤–≤–µ–¥–µ–Ω–æ 0 —Å–∏–º–≤–æ–ª–æ–≤) ?
  79 0068 0F843901 	  je stop
  79      0000
  80              	
  81 006e 803D6400 	  cmpb $'\n', c 	# —ç—Ç–æ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ ?
  81      00000A
  82 0075 745A     	  je get_digit 	# –î–ê - –Ω–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ü–∏—Ñ—Ä—ã –≤ –±—É—Ñ–µ—Ä
  83              	
  84 0077 83FE64   	  cmp $100, %esi 	# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
  85 007a 743A     	  je buff_end
  86              	
  87 007c 803D6400 	  cmpb $'9', c  	# –∫–æ–¥ –±–æ–ª—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '6' ?
  87      000039
  88 0083 7717     	  ja print_err_msg	# –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  89 0085 803D6400 	  cmpb $'0', c	# –∫–æ–¥ –º–µ–Ω—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '1' ?
  89      000030
  90 008c 720E     	  jb print_err_msg # –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  91              	
  92              	
  93 008e A0640000 	  movb c, %al         # –∫–æ–¥ –∏–∑ —Å –ø–∏—à–µ–º –≤ al
  93      00
  94 0093 88860000 	  movb %al, buf(%esi) # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ al (–≤–≤–µ–¥–µ–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  94      0000
  95              	        											# –∞–¥—Ä–µ—Å—É buf + esi (–±—É—Ñ–µ—Ä –¥–ª—è –≤–≤–æ–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤)
  96 0099 46       	  incl %esi						# —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ –¥–ª—è —Å–ª–µ–¥—É
  97              	
  98 009a EBB3     	  jmp kbd_input	# –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  99              	
 100              	print_err_msg:
 101              		Puts "–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ —Ü–∏—Ñ—Ä 0-9 –∏ –±—ã—Ç—å –º–µ–Ω—å—à–µ 13"	# –≤
 101              	> .data
 101 0039 D0A7D0B8 	>  str2:.ascii "–ß–∏—Å–ª–æ –¥–æ–ª–∂–Ω–æ —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ —Ü–∏—Ñ—Ä 0-9 –∏ –±—ã—Ç—å –º–µ–Ω—å—à–µ 13\n"
 101      D181D0BB 
 101      D0BE20D0 
 101      B4D0BED0 
 101      BBD0B6D0 
 101              	> 
 101              	>  strlen2 =. - str2
 101              	> 
 101              	> .text
 101 009c B8040000 	>  movl $4,%eax
 101      00
 101 00a1 BB010000 	>  movl $1,%ebx
 101      00
GAS LISTING fact.S 			page 5


 101 00a6 B9390000 	>  movl $str2,%ecx
 101      00
 101 00ab BA570000 	>  movl $strlen2,%edx
 101      00
 101 00b0 CD80     	>  int $0x80
 102 00b2 29F6     		subl %esi, %esi
 103 00b4 EB99     	  jmp kbd_input 	# –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
 104              	
 105              	buff_end:
 106              	  Puts "–ë—É—Ñ–µ—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è"
 106              	> .data
 106 0090 D091D183 	>  str3:.ascii "–ë—É—Ñ–µ—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è\n"
 106      D184D0B5 
 106      D18020D0 
 106      B7D0B0D0 
 106      BAD0BED0 
 106              	> 
 106              	>  strlen3 =. - str3
 106              	> 
 106              	> .text
 106 00b6 B8040000 	>  movl $4,%eax
 106      00
 106 00bb BB010000 	>  movl $1,%ebx
 106      00
 106 00c0 B9900000 	>  movl $str3,%ecx
 106      00
 106 00c5 BA200000 	>  movl $strlen3,%edx
 106      00
 106 00ca CD80     	>  int $0x80
 107 00cc E9D60000 	  jmp stop
 107      00
 108              	
 109              	get_digit:
 110 00d1 C7050400 		movl $0, number
 110      00000000 
 110      0000
 111 00db 83FE00   	  cmp $0, %esi
 112 00de 0F846BFF 	  je kbd_input
 112      FFFF
 113              	
 114 00e4 4E       	  decl %esi
 115 00e5 29C0     	  sub %eax, %eax
 116 00e7 8A860000 	  movb buf(%esi), %al
 116      0000
 117 00ed 83E830   	  sub $48, %eax
 118              	
 119 00f0 01050400 	  addl %eax, number
 119      0000
 120              	
 121 00f6 83FE00   	  cmp $0, %esi
 122 00f9 742A     	  je call_func
 123              	
 124 00fb 4E       	  decl %esi
 125 00fc 29C0     	  sub %eax, %eax
 126 00fe 8A860000 		movb buf(%esi), %al
 126      0000
 127 0104 46       		incl %esi
GAS LISTING fact.S 			page 6


 128 0105 46       		incl %esi
 129 0106 83E830   	  sub $48, %eax
 130              	
 131 0109 89C3     	  movl %eax, %ebx
 132 010b B80A0000 	  movl $10, %eax
 132      00
 133 0110 F7E3     		mul %ebx
 134              	
 135 0112 01050400 	  addl %eax, number
 135      0000
 136 0118 833D0400 	  cmp $12, number
 136      00000C
 137 011f 0F8777FF 	  ja print_err_msg
 137      FFFF
 138              	
 139              	call_func:
 140 0125 46       		incl %esi
 141 0126 FF350400 		pushl number        # –ß–∏—Å–ª–æ –≤ —Å—Ç–µ–∫
 141      0000
 142 012c B8010000 		movl $1, %eax
 142      00
 143 0131 E8CAFEFF 	  call Fact   # –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏
 143      FF
 144 0136 A3000000 	  movl %eax, result
 144      00
 145              	
 146 013b 83C404   	  addl $4,%esp    # –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–µ–∫ –æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ Read_Sym
 147 013e 61       	  popa         # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä—ã –≥–ª–∞–≤–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º—ã
 148              	
 149              	convert:
 150 013f BB000000 	  	movl $0, %ebx           # —Å—á–µ—Ç—á–∏–∫ –¥–µ–ª–µ–Ω–∏–π
 150      00
 151 0144 A1000000 	  	movl result, %eax            # –≥–æ—Ç–æ–≤–∏–º –¥–µ–ª–µ–Ω–∏–µ
 151      00
 152 0149 BE090000 	  	movl $9,%esi		# –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ —Å—Ç–∞—Ä—à–∏–π –±–∞–π—Ç 
 152      00
 153              	
 154              	nextdigit:
 155 014e BA000000 	  	movl $0, %edx           # –µ—â–µ –≥–æ—Ç–æ–≤–∏–º
 155      00
 156 0153 F73D1600 	  	idivl ten               # –¥–µ–ª–∏–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã edx:eax –Ω–∞ 10
 156      0000
 157              	  	                                # —á–∞—Å—Ç–Ω–æ–µ –≤  eax, –æ—Å—Ç–∞—Ç–æ–∫ –≤ edx
 158 0159 83C230   	    addl $48,%edx            # –ü—Ä–µ–≤—Ä–∞—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞ –≤ –∫–æ–¥ —Ü–∏—Ñ—
 159              	
 160 015c 88960800 	  	movb %dl,digits_of_n(%esi)
 160      0000
 161              	
 162              	  	#	–≥–æ—Ç–æ–≤–∏–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥. —Ü–∏—Ñ—Ä—ã
 163              	
 164 0162 83C301   	    addl $1, %ebx           # —Å—á–µ—Ç—á–∏–∫ –¥–µ–ª–µ–Ω–∏–π + 1
 165 0165 4E       	  	decl %esi		# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –±–∞–π—Ç –¥–ª—è
 166              	  												# —Å–ª–µ–¥. —Ü–∏—Ñ—Ä—ã
 167 0166 83F800   	  	cmpl $0, %eax           # —á–∞—Å—Ç–Ω–æ–µ = 0 ?
 168 0169 7FE3     	  	jg nextdigit         # –ù–ï–¢, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
 169 016b 891D1200 	  	movl %ebx, length       # –î–ê, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
 169      0000
GAS LISTING fact.S 			page 7


 170              	  	PutsRes $digits_of_n
 170 0171 B8040000 	>  movl $4,%eax
 170      00
 170 0176 BB010000 	>  movl $1,%ebx
 170      00
 170 017b B9080000 	>  movl $digits_of_n,%ecx
 170      00
 170 0180 83C10A   	>  addl $10,%ecx
 170 0183 2B0D1200 	>  subl length,%ecx
 170      0000
 170 0189 8B151200 	>  movl length,%edx
 170      0000
 170 018f CD80     	>  int $0x80
 171              	  	Puts ""
 171              	> .data
 171 00b0 0A       	>  str5:.ascii "\n"
 171              	> 
 171              	>  strlen5 =. - str5
 171              	> 
 171              	> .text
 171 0191 B8040000 	>  movl $4,%eax
 171      00
 171 0196 BB010000 	>  movl $1,%ebx
 171      00
 171 019b B9B00000 	>  movl $str5,%ecx
 171      00
 171 01a0 BA010000 	>  movl $strlen5,%edx
 171      00
 171 01a5 CD80     	>  int $0x80
 172              	
 173              	stop:
 174              	  Exit $0
 174 01a7 B8010000 	>  movl $1,%eax
 174      00
 174 01ac BB000000 	>  movl $0,%ebx
 174      00
 174 01b1 CD80     	>  int $0x80
 175              	  .end
GAS LISTING fact.S 			page 8


DEFINED SYMBOLS
              fact.S:9      .data:0000000000000000 result
              fact.S:10     .data:0000000000000004 number
              fact.S:11     .data:0000000000000008 digits_of_n
              fact.S:12     .data:0000000000000012 length
              fact.S:13     .data:0000000000000016 ten
              fact.S:16     .bss:0000000000000000 buf
              fact.S:16     .bss:0000000000000064 c
              fact.S:23     .text:0000000000000000 Fact
              fact.S:38     .text:000000000000000d FactStep
              fact.S:56     .text:000000000000002e Return
              fact.S:51     .text:000000000000002a EndReturn
              fact.S:67     .text:0000000000000037 _start
              fact.S:73     .data:000000000000001a str0
              fact.S:73     *ABS*:000000000000001f strlen0
              fact.S:75     .text:000000000000004f kbd_input
              fact.S:173    .text:00000000000001a7 stop
              fact.S:109    .text:00000000000000d1 get_digit
              fact.S:105    .text:00000000000000b6 buff_end
              fact.S:100    .text:000000000000009c print_err_msg
              fact.S:101    .data:0000000000000039 str2
              fact.S:101    *ABS*:0000000000000057 strlen2
              fact.S:106    .data:0000000000000090 str3
              fact.S:106    *ABS*:0000000000000020 strlen3
              fact.S:139    .text:0000000000000125 call_func
              fact.S:149    .text:000000000000013f convert
              fact.S:154    .text:000000000000014e nextdigit
              fact.S:171    .data:00000000000000b0 str5
              fact.S:171    *ABS*:0000000000000001 strlen5

NO UNDEFINED SYMBOLS
