GAS LISTING task3.S 			page 1


   1              	/*
   2              	 * –ü—Ä–æ–≥—Ä–∞–º–º–∞ –≤–≤–æ–¥–∞ –∫–æ–¥–æ–≤ —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –±—É—Ñ–µ—Ä –∏ –≤—ã
   3              	 */
   4              	
   5              	.include "my-macro"
   1              	/* 
   2              	 * –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
   3              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
   4              	 * 	- –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
   5              	 *
   6              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
   7              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              		movl $1, %eax 		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit
  11              		movl \ret_val, %ebx 	# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
  12              		int $0x80 		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–∏–
  18              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  19              	 * 	- –∞–¥—Ä–µ—Å –±—É—Ñ—Ñ–µ—Ä–∞ –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞
  20              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  21              	 *	- –≤ %eax –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  22              	 *	- –ø–æ –∞–¥—Ä–µ—Å—É buf_addr - —Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  23              	 * 
  24              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  25              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 read'
  26              	*/
  27              	.macro Getchar buf_addr
  28              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
  29              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  30              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  31              		     			# –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  32              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  33              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  34              	.endm
  35              	
  36              	/*
  37              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∞–Ω–¥
  38              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  39              	 * 	- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞.
  40              	 *
  41              	 * –ü—Ä–∏–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞:
  42              	 *	Puts "–¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º–æ–π —Å—Ç—Ä–æ–∫–∏" 
  43              	 *
  44              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  45              	 *	- –≤—ã–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª—ã –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫
  46              	 *	  –∞ —Ç–∞–∫–∂–µ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏
  47              	 *	
  48              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  49              	 * –°–º. —Ç–∞–∫–∂–µ 'man puts', 'man 2 write'
  50              	*/
  51              	.macro Puts string
  52              	.data
GAS LISTING task3.S 			page 2


  53              	    str\@: 	.ascii "\string\n"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª
  54              		
  55              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  56              	
  57              	.text
  58              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  59              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞	
  60              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  61              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  62              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  63              	.endm
  64              	
   6              	
   7              	.bss
   8              	    .lcomm buf, 100 # –±—É—Ñ–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤. –
   9              	    .lcomm c, 1	# –±—É—Ñ–µ—Ä –¥–ª—è —á—Ç–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞. –†–∞–∑–º–µ—Ä - 1 
  10              	    .lcomm s,10	
  11              	.text
  12              	.global _start
  13              	
  14              	_start:
  15 0000 29F6     	    sub	%esi, %esi     # —É–∫–∞–∑–∞—Ç–µ–ª—å –∞–¥—Ä–µ—Å–∞ –±–∞–π—Ç–∞ –≤ –±—É—Ñ–µ—Ä–µ —Å–∏–º–≤–æ–ª–æ–
  16 0002 C6056800 	    movb $10,s    
  16      00000A
  17              	
  18              	show_prompt:
  19              	    Puts "–í–≤–æ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—É, –¥—Ä—É–≥ –º–æ–π!" 	# –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–
  19              	> .data
  19 0000 D092D0B2 	>  str0:.ascii "–í–≤–æ–¥–∏—Ç–µ —Ü–∏—Ñ—Ä—É, –¥—Ä—É–≥ –º–æ–π!\n"
  19      D0BED0B4 
  19      D0B8D182 
  19      D0B520D1 
  19      86D0B8D1 
  19              	>  
  19              	>  strlen0 =. - str0
  19              	> 
  19              	> .text
  19 0009 B8040000 	>  movl $4,%eax
  19      00
  19 000e BB010000 	>  movl $1,%ebx
  19      00
  19 0013 B9000000 	>  movl $str0,%ecx
  19      00
  19 0018 BA2C0000 	>  movl $strlen0,%edx
  19      00
  19 001d CD80     	>  int $0x80
  20              						# –≤—ã–≤–æ–¥ (–ø–æ–¥—Å–∫–∞–∑–∫–∞ –≤–≤–æ–¥–∞)
  21              	
  22              	kbd_input:
  23              	    Getchar $c          # –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤ –≤–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–
  23 001f B8030000 	>  movl $3,%eax
  23      00
  23 0024 BB000000 	>  movl $0,%ebx
  23      00
  23 0029 B9640000 	>  movl $c,%ecx
  23      00
  23              	>  
GAS LISTING task3.S 			page 3


  23 002e BA010000 	>  movl $1,%edx
  23      00
  23 0033 CD80     	>  int $0x80
  24              	    
  25 0035 83F800   	    cmpl $0, %eax 	# –ö–æ–Ω–µ—Ü —Ñ–∞–π–ª - EOF (–≤–≤–µ–¥–µ–Ω–æ 0 —Å–∏–º–≤–æ–ª–æ–≤) ? 
  26 0038 0F849500 	    je stop		# –î–∞ - –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã
  26      0000
  27              	    
  28 003e 803D6400 	    cmpb $'\n', c 	# —ç—Ç–æ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ ?
  28      00000A
  29 0045 7471     	    je T1
  30 0047 803D6400 	    cmpb $'9', c  	# –∫–æ–¥ –±–æ–ª—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '9' ?
  30      000039
  31 004e 7735     	    ja print_err_msg	# –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  32 0050 803D6400 	    cmpb $'0', c	# –∫–æ–¥ –º–µ–Ω—å—à–µ –∫–æ–¥–∞ —Å–∏–º–≤–æ–ª–∞ '0' ?
  32      000030
  33 0057 722C     	    jb print_err_msg	# –î–ê - –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–µ
  34 0059 3B356800 	    cmp s,%esi
  34      0000
  35 005f 743F     	    je buff_end
  36              	
  37 0061 A0640000 	    movb c, %al         # –∫–æ–¥ –∏–∑ —Å –ø–∏—à–µ–º –≤ al
  37      00
  38 0066 88860000 	    movb %al, buf(%esi) # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ al (–≤–≤–µ–¥–µ–Ω–Ω—ã–π —Å–∏–º–≤–æ
  38      0000
  39              				# –∞–¥—Ä–µ—Å—É buf + esi (–±—É—Ñ–µ—Ä –¥–ª—è –≤–≤–æ–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤)
  40 006c 46       	    incl %esi		# —É–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ –¥–ª—è —Å–ª–µ–¥—É—é
  41              	
  42              	    Puts "–¶–∏—Ñ—Ä–∞! –•–æ—Ä–æ—à–æ." # –≤—ã–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—à–Ω–æ–º –≤–≤–æ–¥
  42              	> .data
  42 002c D0A6D0B8 	>  str2:.ascii "–¶–∏—Ñ—Ä–∞! –•–æ—Ä–æ—à–æ.\n"
  42      D184D180 
  42      D0B02120 
  42      D0A5D0BE 
  42      D180D0BE 
  42              	>  
  42              	>  strlen2 =. - str2
  42              	> 
  42              	> .text
  42 006d B8040000 	>  movl $4,%eax
  42      00
  42 0072 BB010000 	>  movl $1,%ebx
  42      00
  42 0077 B92C0000 	>  movl $str2,%ecx
  42      00
  42 007c BA1A0000 	>  movl $strlen2,%edx
  42      00
  42 0081 CD80     	>  int $0x80
  43              	    
  44 0083 EB84     	    jmp show_prompt	# –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  45              	
  46              	print_err_msg:
  47              	    Puts "–ù–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏—à–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥"	# –≤—ã–≤–æ–¥ —Å–æ–æ–±—
  47              	> .data
  47 0046 D09DD0B5 	>  str3:.ascii "–ù–µ —Ü–∏—Ñ—Ä–æ–≤–∞—è –∫–ª–∞–≤–∏—à–∞. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –≤–≤–æ–¥\n"
  47      20D186D0 
  47      B8D184D1 
GAS LISTING task3.S 			page 4


  47      80D0BED0 
  47      B2D0B0D1 
  47              	>  
  47              	>  strlen3 =. - str3
  47              	> 
  47              	> .text
  47 0085 B8040000 	>  movl $4,%eax
  47      00
  47 008a BB010000 	>  movl $1,%ebx
  47      00
  47 008f B9460000 	>  movl $str3,%ecx
  47      00
  47 0094 BA420000 	>  movl $strlen3,%edx
  47      00
  47 0099 CD80     	>  int $0x80
  48 009b E969FFFF 	    jmp show_prompt 	# –Ω–∞ –≤–≤–æ–¥ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
  48      FF
  49              	buff_end:
  50              		Puts "–ù–µ—Ç—É –º–µ—Å—Ç–∞"
  50              	> .data
  50 0088 D09DD0B5 	>  str4:.ascii "–ù–µ—Ç—É –º–µ—Å—Ç–∞\n"
  50      D182D183 
  50      20D0BCD0 
  50      B5D181D1 
  50      82D0B00A 
  50              	>  
  50              	>  strlen4 =. - str4
  50              	> 
  50              	> .text
  50 00a0 B8040000 	>  movl $4,%eax
  50      00
  50 00a5 BB010000 	>  movl $1,%ebx
  50      00
  50 00aa B9880000 	>  movl $str4,%ecx
  50      00
  50 00af BA140000 	>  movl $strlen4,%edx
  50      00
  50 00b4 CD80     	>  int $0x80
  51 00b6 EB1B     		jmp stop
  52              	
  53              	T1:
  54 00b8 83FE00   		cmp $0, %esi #
  55 00bb 0F845EFF 		je kbd_input #–µ—Å–ª–∏ esi —Ä–∞–≤–Ω–æ 0 –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –º–µ—Ç–∫—É kbd_input
  55      FFFF
  56 00c1 4E       		decl %esi # —É–º–µ–Ω—å—à–∞–µ–º esi –Ω–∞ 1 
  57 00c2 8A9E0000 		movb buf(%esi),%bl #  –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –±—É—Ñ–µ—Ä–∞ (buf+%esi) –≤ ebx
  57      0000
  58 00c8 83EB30   		sub $48,%ebx # –≤—ã—á–∏—Ç–∞–µ–º –∏–∑ ebx 48
  59 00cb 89D8     		mov %ebx,%eax # –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ eax ebx
  60 00cd 46       		incl %esi # —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –Ω–∞ 1
  61 00ce E94CFFFF 		jmp kbd_input # –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –º–µ—Ç–∫—É kbd_input
  61      FF
  62              	
  63              	stop:
  64              	    Exit $0
  64 00d3 B8010000 	>  movl $1,%eax
  64      00
GAS LISTING task3.S 			page 5


  64 00d8 BB000000 	>  movl $0,%ebx
  64      00
  64 00dd CD80     	>  int $0x80
  65              	    
  66              	.end
GAS LISTING task3.S 			page 6


DEFINED SYMBOLS
             task3.S:8      .bss:0000000000000000 buf
             task3.S:8      .bss:0000000000000064 c
             task3.S:10     .bss:0000000000000068 s
             task3.S:14     .text:0000000000000000 _start
             task3.S:18     .text:0000000000000009 show_prompt
             task3.S:19     .data:0000000000000000 str0
             task3.S:19     *ABS*:000000000000002c strlen0
             task3.S:22     .text:000000000000001f kbd_input
             task3.S:63     .text:00000000000000d3 stop
             task3.S:53     .text:00000000000000b8 T1
             task3.S:46     .text:0000000000000085 print_err_msg
             task3.S:49     .text:00000000000000a0 buff_end
             task3.S:42     .data:000000000000002c str2
             task3.S:42     *ABS*:000000000000001a strlen2
             task3.S:47     .data:0000000000000046 str3
             task3.S:47     *ABS*:0000000000000042 strlen3
             task3.S:50     .data:0000000000000088 str4
             task3.S:50     *ABS*:0000000000000014 strlen4

NO UNDEFINED SYMBOLS
