GAS LISTING PrintResult.S 			page 1


   1              	.include "my-macro" # –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å –º–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º–∏
   1              	/*
   2              	 * –ú–∞–∫—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã.
   3              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
   4              	 * 	- –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã
   5              	 *
   6              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
   7              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 exit'
   8              	*/
   9              	.macro Exit ret_val
  10              		movl $1, %eax 		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ exit
  11              		movl \ret_val, %ebx 	# –∫–æ–¥ –≤—ã—Ö–æ–¥–∞
  12              		int $0x80 		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  13              	.endm
  14              	
  15              	
  16              	/*
  17              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Å–∏–
  18              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  19              	 * 	- –∞–¥—Ä–µ—Å –±—É—Ñ—Ñ–µ—Ä–∞ –¥–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–∞
  20              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  21              	 *	- –≤ %eax –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
  22              	 *	- –ø–æ –∞–¥—Ä–µ—Å—É buf_addr - —Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å–∏–º–≤–æ–ª
  23              	 *
  24              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  25              	 * –°–º. —Ç–∞–∫–∂–µ 'man 2 read'
  26              	*/
  27              	.macro Getchar buf_addr
  28              		movl $3, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ read
  29              		movl $0, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞
  30              		movl \buf_addr, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –±—É—Ñ–µ—Ä–∞ (–æ–Ω –∂–µ - —Ñ–∞–∫—Ç–∏—á–µ—Å–∫
  31              		     			# –ø–∞—Ä–∞–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞)
  32              		movl $1, %edx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è —á—Ç–µ–Ω–∏—è
  33              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  34              	.endm
  35              	
  36              	.macro PutsInLine string
  37              	.data
  38              	    str\@: 	.ascii "\string"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª—è
  39              	
  40              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  41              	
  42              	.text
  43              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  44              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  45              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  46              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  47              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  48              	.endm
  49              	
  50              	/*
  51              	 * –ú–∞—Ä–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –≤—ã–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –≤ —Å—Ç–∞–Ω–¥
  52              	 * –ê—Ä–≥—É–º–µ–Ω—Ç—ã:
  53              	 * 	- –°—Ç—Ä–æ–∫–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞.
  54              	 *
  55              	 * –ü—Ä–∏–º–µ—Ç—Ä –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞:
  56              	 *	Puts "–¢–µ–∫—Å—Ç –≤—ã–≤–æ–¥–∏–º–æ–π —Å—Ç—Ä–æ–∫–∏"
GAS LISTING PrintResult.S 			page 2


  57              	 *
  58              	 * –†–µ–∑—É–ª—å—Ç–∞—Ç:
  59              	 *	- –≤—ã–≤–æ–¥–∏—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ —Å–∏–º–≤–æ–ª—ã –∑–∞–¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫
  60              	 *	  –∞ —Ç–∞–∫–∂–µ —Å–∏–º–≤–æ–ª –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏
  61              	 *
  62              	 * –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∞–∫—Ä–æ–≤—ã–∑–æ–≤–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è —Ä–µ–≥–∏—Å—Ç—Ä—ã: %e
  63              	 * –°–º. —Ç–∞–∫–∂–µ 'man puts', 'man 2 write'
  64              	*/
  65              	.macro Puts string
  66              	.data
  67              	    str\@: 	.ascii "\string\n"  # —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–æ–∫–∏ –¥–ª
  68              	
  69              	    strlen\@ = 	. - str\@           # –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã —Å—Ç—Ä–æ–∫–∏
  70              	
  71              	.text
  72              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  73              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  74              		movl $str\@, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  75              		movl $strlen\@, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  76              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  77              	.endm
  78              	
  79              	.macro PutsRes res
  80              		movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  81              		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  82              		movl \res, %ecx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ–
  83              		addl $10, %ecx
  84              		subl length, %ecx
  85              		movl length, %edx # –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  86              		int $0x80		# –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
  87              	.endm
   2              	.text # —Å–µ–∫—Ü–∏—è –∫–æ–º–∞–Ω–¥ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞
   3              	.data
   4 0000 20202020 	  digits_of_n: .ascii "          "
   4      20202020 
   4      2020
   5 000a 0A000000 	  ten: .long 10
   6 000e 00000000 	  length: .long 0
   7 0012 0A       	  str: .ascii "\n"
   8 0013 2D       	  minus: .ascii "-"
   9              	.type	Print_Result, @function	# —Ñ—É–Ω–∫—Ü–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Å—Å–∏
  10              	.globl	Print_Result		# –∏–º—è –º–æ–∂–µ—Ç –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨–°–Ø –≤–Ω–µ —ç—Ç–æ–≥–æ –∏—Å—Ö. —Ñ–
  11              	Print_Result:
  12              	
  13              		# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—Ä–æ–ª–æ–≥ —Ñ—É–Ω—Ü–∏–∏
  14              	
  15 0014 55       	  pushl %ebp 	 # —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å—Ç–µ–∫–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –±—ã–≤—à–µ–µ –≤ –≤—ã–∑—ã–≤–∞—é—
  16 0015 89E5     		movl  %esp, %ebp # –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∞–¥—Ä–µ—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏
  17              				 # –ª–æ–∫–∞–ª—å–Ω—ã–º –ø–µ—Ä–µ–º–µ–Ω–Ω–Ω—ã–º –≤ —Å—Ç–µ–∫–µ –ø—É—Ç–µ–º –±–∞–∑–æ–≤–æ–π
  18              				 # –∞–¥—Ä–µ—Å–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ebp
  19              	
  20              		# –¢–µ–ª–æ —Ñ—É–Ω–∫—Ü–∏–∏
  21              	
  22              	NextSym:
  23 0017 8B4508   		movl 8(%ebp), %eax  # –∞–¥—Ä–µ—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞-—Å—É–º–º—ã –≤ edx
  24              	
  25              	convert:
GAS LISTING PrintResult.S 			page 3


  26 001a 83F800   	  cmpl $0, %eax
  27 001d 7C02     	  jl Negative
  28 001f EB2A     	  jmp Positive
  29              	
  30              	Negative:
  31              	  # –í—ã–≤–æ–¥ –º–∏–Ω—É—Å–∞ –Ω–∞ —ç–∫—Ä–∞–Ω
  32 0021 B8040000 	  movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  32      00
  33 0026 BB010000 		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  33      00
  34 002b B9130000 		movl $minus, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ
  34      00
  35 0030 BA010000 		movl $1, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  35      00
  36 0035 CD80     		int $0x80
  37              	
  38 0037 BB000000 	  movl $0, %ebx           # —Å—á–µ—Ç—á–∏–∫ –¥–µ–ª–µ–Ω–∏–π
  38      00
  39 003c BE090000 	  movl $9,%esi		# –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ —Å—Ç–∞—Ä—à–∏–π –±–∞–π—Ç —
  39      00
  40              	
  41 0041 B8000000 	  movl $0, %eax
  41      00
  42 0046 2B4508   	  subl 8(%ebp), %eax
  43 0049 EB0C     	  jmp nextdigit
  44              	
  45              	Positive:
  46 004b BB000000 	  movl $0, %ebx           # —Å—á–µ—Ç—á–∏–∫ –¥–µ–ª–µ–Ω–∏–π
  46      00
  47 0050 BE090000 	  movl $9, %esi		# –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ —Å—Ç–∞—Ä—à–∏–π –±–∞–π—Ç 
  47      00
  48 0055 EB00     	  jmp nextdigit
  49              	
  50              	nextdigit:
  51 0057 BA000000 	  movl $0, %edx           # –µ—â–µ –≥–æ—Ç–æ–≤–∏–º
  51      00
  52 005c F73D0A00 	  idivl ten               # –¥–µ–ª–∏–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã edx:eax –Ω–∞ 10
  52      0000
  53              	    	                                # —á–∞—Å—Ç–Ω–æ–µ –≤  eax, –æ—Å—Ç–∞—Ç–æ–∫ –≤ edx
  54 0062 83C230   	  addl $48,%edx            # –ü—Ä–µ–≤—Ä–∞—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞ –≤ –∫–æ–¥ —Ü–∏—Ñ—Ä—
  55              	
  56 0065 88960000 	  movb %dl,digits_of_n(%esi)
  56      0000
  57              	
  58              	  #	–≥–æ—Ç–æ–≤–∏–º –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–ª–µ–¥. —Ü–∏—Ñ—Ä—ã
  59              	
  60 006b 83C301   	  addl $1, %ebx           # —Å—á–µ—Ç—á–∏–∫ –¥–µ–ª–µ–Ω–∏–π + 1
  61 006e 4E       	  decl %esi		# —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –±–∞–π—Ç –¥–ª—è
  62              	    										# —Å–ª–µ–¥. —Ü–∏—Ñ—Ä—ã
  63 006f 83F800   	  cmpl $0, %eax           # —á–∞—Å—Ç–Ω–æ–µ = 0 ?
  64 0072 7FE3     	  jg nextdigit         # –ù–ï–¢, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
  65 0074 891D0E00 	  movl %ebx, length       # –î–ê, —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  65      0000
  66              	  PutsRes $digits_of_n
  66 007a B8040000 	>  movl $4,%eax
  66      00
  66 007f BB010000 	>  movl $1,%ebx
GAS LISTING PrintResult.S 			page 4


  66      00
  66 0084 B9000000 	>  movl $digits_of_n,%ecx
  66      00
  66 0089 83C10A   	>  addl $10,%ecx
  66 008c 2B0D0E00 	>  subl length,%ecx
  66      0000
  66 0092 8B150E00 	>  movl length,%edx
  66      0000
  66 0098 CD80     	>  int $0x80
  67              	
  68              	
  69              	  # –í—ã–≤–æ–¥ –ø–µ—Ä–µ–≤–æ–¥–∞ —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω
  70 009a B8040000 	  movl $4, %eax		# –Ω–æ–º–µ—Ä —Å–∏—Å—Ç. –≤—ã–∑–æ–≤–∞ write
  70      00
  71 009f BB010000 		movl $1, %ebx		# –ø–∞—Ä–∞–º–µ—Ç—Ä 1: –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
  71      00
  72 00a4 B9120000 		movl $str, %ecx	# –ø–∞—Ä–∞–º–µ—Ç—Ä 2: –∞–¥—Ä–µ—Å –ø–∞–º—è—Ç–∏ —Å –≤—ã–≤–æ–¥–∏–º—ã–º–∏ —Å–∏–º–≤–æ–ª
  72      00
  73 00a9 BA010000 		movl $1, %edx 	# –ø–∞—Ä–∞–º–µ—Ç—Ä 3: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∞–π—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞
  73      00
  74 00ae CD80     		int $0x80
  75              	
  76              	
  77              	
  78 00b0 B8010000 	  movl $1, %eax
  78      00
  79              	
  80              	  # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —ç–ø–∏–ª–æ–≥ —Ñ—É–Ω–∫—Ü–∏–∏
  81              	Epilog:
  82 00b5 89EC     	  movl %ebp, %esp # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞
  83 00b7 5D       	  popl %ebp       # –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ebp
  84 00b8 C3       	  ret		# –≤–æ–∑–≤—Ä–∞—Ç –≤ –≤—ã–∑—ã–≤–∞—é—â—É—é
  85              	
  86              	.end
GAS LISTING PrintResult.S 			page 5


DEFINED SYMBOLS
       PrintResult.S:4      .data:0000000000000000 digits_of_n
       PrintResult.S:5      .data:000000000000000a ten
       PrintResult.S:6      .data:000000000000000e length
       PrintResult.S:7      .data:0000000000000012 str
       PrintResult.S:8      .data:0000000000000013 minus
       PrintResult.S:11     .data:0000000000000014 Print_Result
       PrintResult.S:22     .data:0000000000000017 NextSym
       PrintResult.S:25     .data:000000000000001a convert
       PrintResult.S:30     .data:0000000000000021 Negative
       PrintResult.S:45     .data:000000000000004b Positive
       PrintResult.S:50     .data:0000000000000057 nextdigit
       PrintResult.S:81     .data:00000000000000b5 Epilog

NO UNDEFINED SYMBOLS
